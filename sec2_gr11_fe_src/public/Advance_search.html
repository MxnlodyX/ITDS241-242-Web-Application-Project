<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>PUMA-SHOP</title>
    <link rel="stylesheet" href="/styles/Header_Footer.css" />
    <link rel="stylesheet" href="/styles/Banner_pages.css" />
    <link rel="stylesheet" href="/styles/Adsearch.css" />
    <!----Slick Library----->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0-beta3/css/all.min.css" />
    <style></style>
  </head>
  <body>
    <header>
      <div class="logo">
        <a name="logo" href="/homepage"><img src="/Assets/Logo/Logo.png" alt="" /></a>
      </div>
      <div class="shipping-text">
        <p style="font-size: 14.5px">Deliver to</p>
        <p>THAILAND</p>
      </div>
      <div class="search">
        <input class="search-box" type="text" placeholder="Searching for Something that you interesting !!" />
        <a href="/Advance_search">
          <button class="search-btn">
            <i class="fas fa-search"></i>
          </button>
        </a>
      </div>
      <div class="login">
        <a href="/Our_store" style="text-align: center">Find Our Stores</a>

        <a href="/login" style="text-align: center">Login</a>
      </div>
    </header>

    <nav>
      <ul>
        <li>
          <a href="/homepage">Home</a>
        </li>
        <li class="">
          <a href="/products">Product</a>
        </li>
        <li class="">
          <a href="/products?Product_type=Shirt">Shirt</a>
        </li>
        <li class="">
          <a href="/products?Product_type=Sneaker">Sneaker</a>
        </li>
        <li class="">
          <a href="/products?Product_type=Hat">Hat</a>
        </li>
        <li class="">
          <a href="/products?Product_type=Running">Running</a>
        </li>
        <li class="">
          <a href="/products?Product_type=Football">Football</a>
        </li>
        <li class="">
          <a href="/about_us">About us</a>
        </li>
        <li class="Shopping-Cart">
          <i class="fa fa-shopping-cart" style="font-size: 20px"></i>
          CART
          <div class="order-details">
            <div class="arrow-up"></div>
            <p class="Lasted">Lasted Product</p>
            <div class="Product-Cart">
              <div class="Product-img">
                <img src="/Assets/Product/รองเท้าผ้าใบ-Rebound-V6-Lo-Youth.avif" alt="" />
              </div>
              <div class="Product-name">
                <p>Rebound V6 Lo Youth</p>
              </div>
              <div class="Product-Price">
                <p name="price">฿3200</p>
              </div>
            </div>
            <div class="Product-Cart">
              <div class="Product-img">
                <img src="/Assets/Product/รองเท้าผ้าใบ-Rebound-V6-Lo-Youth.avif" alt="" />
              </div>
              <div class="Product-name">
                <p>Hood PUMA FIT Move</p>
              </div>
              <div class="Product-Price">
                <p name="price">฿2500</p>
              </div>
            </div>
            <div class="Product-Cart">
              <div class="Product-img">
                <img src="/Assets/Product/รองเท้าผ้าใบ-Rebound-V6-Lo-Youth.avif" alt="" />
              </div>
              <div class="Product-name">
                <p>PUMA LOVELY PUMA</p>
              </div>
              <div class="Product-Price">
                <p name="price">฿1900</p>
              </div>
            </div>
            <button>SEE MORE ITEMS</button>
          </div>
        </li>
      </ul>
    </nav>
    <section class="Banner_Page">
      <h1>Advance Search</h1>
    </section>

    <section class="advance-search">
      <div class="form-search">
        <form action="">
          <div class="form-input">
            <label class="title" for="productname">Product Name</label>
            <input type="text" id="productname" />
          </div>
          <div class="form-input">
            <label class="title" for="producttype">Product Type:</label>
            <select id="producttype">
              <option value="Hat">Hat</option>
              <option value="Shirt">Shirt</option>
              <option value="Sneaker">Sneaker</option>
              <option value="Running">Running</option>
              <option value="Football">Football</option>
              <option value="" selected>Select Type</option>
            </select>
          </div>
          <div class="form-input">
            <label class="title" for="gender">Gender</label>
            <div class="filter-option"><input class="select-info" type="radio" name="gender" value="M" />Male</div>
            <div class="filter-option"><input class="select-info" type="radio" name="gender" value="F" />Female</div>
            <div class="filter-option"><input class="select-info" type="radio" name="gender" value="U" />Unisex</div>
          </div>
          <div class="form-input">
            <label class="title" for="collection">Collection</label>
            <select id="collection">
              <option value="Winter">Winter</option>
              <option value="Summer">Summer</option>
              <option value="Rainny">Rainny</option>
              <option value="" selected>Select Type</option>
            </select>
          </div>
          <div class="form-input">
            <label class="title" for="value">Value</label>
            <label class="select-info" for="min">Min</label>
            <input type="text" id="min" name="min" min="0" />
            <span style="margin: 0 10px">-</span>
            <label class="select-info" for="max">Max</label>
            <input type="text" id="max" name="max" min="0" max="99999" />
          </div>
          <div class="button-search"><button>SEARCH</button></div>
        </form>
      </div>
      <div class="fetch-product-container"></div>
    </section>

    <footer>
      <h2>© Copyright by Group 11 Section 2</h2>
      <h3><a href="/about_us">Contact Our team Click here</a></h3>
    </footer>
    <script type="text/javascript" src="https://code.jquery.com/jquery-3.6.0.min.js"></script>

    <!----Slick Library----->
    <script type="text/javascript" src="/scripts/slick-1.8.1/slick/slick.min.js"></script>
    <!----Slick Action Function----->
    <script type="text/javascript" src="/scripts/slick_and_cart.js"></script>

    <script>
      async function fetchProducts() {
        const productname = document.getElementById("productname").value;
        const producttype = document.getElementById("producttype").value;
        const collection = document.getElementById("collection").value;
        const gender = document.querySelector('input[name="gender"]:checked')?.value || "";
        const min = document.getElementById("min").value || 0; // Default to 0
        const max = document.getElementById("max").value; // Default to 99999
        const url = "http://localhost:5001/api_service/advanceSearchProduct"; // Update with your actual endpoint
        const token = localStorage.getItem("token"); // Retrieve authentication token
        const params = {productname, producttype, gender, collection, min, max};
        const queryString = new URLSearchParams(params).toString();

        try {
          const response = await fetch(`${url}?${queryString}`, {
            method: "GET",
            headers: {
              Authorization: `Bearer ${token}`,
              "Content-Type": "application/json",
            },
          });

          if (!response.ok) {
            throw new Error("Failed to fetch products");
          }

          const data = await response.json();
          renderResults(data.data || []); // Ensure it handles the data properly
        } catch (error) {
          console.error("Error fetching products:", error);
          alert("No matching product.");
        }
      }

      function renderResults(products) {
        const container = document.querySelector(".fetch-product-container");
        container.innerHTML = ""; // Clear the container before rendering new data

        if (products.length === 0) {
          container.innerHTML = "<h3>No products found.</h3>";
          return;
        }

        products.forEach((product) => {
          const box = `
            <div class="box">
              <div class="image">
                <img src="http://localhost:5001/upload/${product.image}" alt="${product.product_name}" />
              </div>
              <div class="info">
                <h2 class="title">${product.product_name}</h2>
                <div class="subinfo">
                  <div class="price">฿${product.product_price}</div>
                </div>
              </div>
              <div class="buy-btn">
                <a href="/detail_product?Product_ID=${product.product_ID}" class="button">BUY</a>
              </div>
            </div>`;
          container.innerHTML += box;
        });
      }

      // Bind the search functionality to the button
      document.querySelector(".button-search button").addEventListener("click", (e) => {
        e.preventDefault(); // Prevent form submission
        fetchProducts(); // Fetch products when the search button is clicked
      });
    </script>
  </body>
</html>
